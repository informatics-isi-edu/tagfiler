$def with ()
$ q_experiment = 'experimentID(experimentID;start;mice;write%%20users)'
$ q_mouse = 'mouseID(mouseID;cage;%%23cells;dob;dos;start;mouse%%20label;mouse%%20strain;samples;treatments;write%%20users)'
$ q_sample = 'sampleID(sampleID;sample%%20type;start;observations;write%%20users)'
$ q_observation = 'observationID(observationID;start;comment;write%%20users)'
$ q_treatment = 'treatmentID(treatmentID;dose;drug;start;write%%20users)'
$ experiments = dict([ (exp.experimentID, exp) for exp in template_query_results[q_experiment] ])
$ mice = dict([ (mouse.mouseID, mouse) for mouse in template_query_results[q_mouse] ])
$ samples = dict([ (samp.sampleID, samp) for samp in template_query_results[q_sample] ])
$ observations = dict([ (obsv.observationID, obsv) for obsv in template_query_results[q_observation] ])
$ treatments = dict([ (treat.treatmentID, treat) for treat in template_query_results[q_treatment] ])

$# weird bug workaround for template engine
$for x in []:
$code
	def showent(storage, keys=None):
            if keys == None:
                keys = storage.keys()
            yield '<ul>'
            for key in keys:
                yield '<li>%s: %s</li>' % (key, storage[key])
            yield '</ul>'

$for experimentID, experiment in experiments.items():
    <h2>Experiment ${experimentID}</h2>
    <h3>Treatments<h3>
    <dl>
    $for treatmentID, treatment in treatments.items():
        <dt>${treatmentID}</dt>
        <dd>$:{showent(treatment, ['drug', 'dose'])}</dd>
    </dl>
