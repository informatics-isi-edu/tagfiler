$def with (tvars)
$ apptarget = tvars.get('apptarget')
$ files = tvars.get('files')
$ referer = tvars.get('referer')
$ role = tvars.get('role')
$ roles = tvars.get('roles')
$ urlquote = tvars.get('urlquote')
$if len(files) > 0:
	$for file in files:
		$ links = []
		$if file['Image Set'] and 'downloader' in roles:
			<!-- Download/View -->
		$elif file.local:
			$ links.append( '<a href="%s/file/%s">Download</a>' % (apptarget, urlquote(file.file)) )
		$else:
			$ links.append( '<a href="%s/file/%s">View</a>' % (apptarget, urlquote(file.file)) )
		$if file['Image Set']:
			$ links.append( '<a href="%s/study/%s?action=download">Download study</a>' % (apptarget, urlquote(file.file)) )
		$if 'downloader' in roles:
			<!-- Tags -->
		$else:
			$ links.append( '<a href="%s/tags/%s">Tags</a>' % (apptarget, urlquote(file.file)) )
		$if file.writeok:
			$for type in [ 'file', 'url' ]:
				$ links.append( '<a href="%s/file/%s?action=define&amp;type=%s">Replace with %s</a>' % (apptarget, urlquote(file.file), type, type) )
		<fieldset>
		  <legend>${file.file}</legend>
		  <table>
		  <tr>
		  <td>
			  $:{', '.join(links)}
		  </td>
		  $if file['Image Set']:
		  	<td>&nbsp;&nbsp;&nbsp;</td>
		  	<td>
			<form enctype="application/x-www-form-urlencoded" action="${apptarget}/tags/${urlquote(file.file)}" method="post">
			    <div>
			    <input type="hidden" name="referer" value="${referer}" />
			    $if file['Downloaded']:
			    	    Downloaded: <input type="checkbox" name="downloaded" value="true" checked />
				    <input type="hidden" name="tag" value="Downloaded" />
				    <input type="hidden" name="action" value="delete" />
				    <input type="submit" value="Clear" />
			    $else:
			    	    Downloaded: <input type="checkbox" name="downloaded" value="true" />
				    <input type="hidden" name="set-Downloaded" value="true" />
				    <input type="hidden" name="action" value="put" />
				    <input type="submit" value="Mark" />
			    </div>
			</form>
		  	</td>
		  $if file.writeok:
		  	<td>
		  	<form enctype="application/x-www-form-urlencoded" action="${apptarget}/file/${urlquote(file.file)}" method="post">
			    <div>
			    <input type="hidden" name="action" value="delete" />
			    <input type="hidden" name="referer" value="${referer}" />
			    <input type="submit" value="Delete" />
			    </div>
			</form>
		  	</td>
		  </tr>
		  </table>
		</fieldset>
$elif 'uploader' in roles:
	<p></p>
$else:
	<p>There are no items to list with your current privileges.</p>
