$def with (tvars)
$ apptarget = tvars.get('apptarget')
$ files = tvars.get('files')
$ referer = tvars.get('referer')
$ role = tvars.get('role')
$ roles = tvars.get('roles')
$ urlquote = tvars.get('urlquote')
$ filelisttags = tvars.get('filelisttags')
$ filelisttagswrite = tvars.get('filelisttagswrite')
$ tagdefs = tvars.get('tagdefs')
$ idquote = tvars.get('idquote')
$ skiptags =  ['Image Set']
$ odd = True
$if len(files) > 0:
	<table class="file-list">
	<tr class="file-heading">
	<th class="file-name">Dataset</th>
	<th class="file-tags">Tags</th>
	<th class="file-update">Update</th>
	$for tag in filelisttags:
		$if tag not in skiptags:
			<th class="file-tag ${idquote(tag)}">$:{tag.replace(" ", "&nbsp;")}</th>
	<th class="file-delete">Delete</th>
	</tr>
	$for file in files:
		$if odd:
			<tr class="file odd">
		$else:
			<tr class="file even">
		$ odd = not odd
		<td class="file-name">
		$if file['Image Set'] and 'downloader' in roles:
			${file.file}
		$else:
			$if file.local:
				$ label = 'Download'
			$else:
				$ label = 'View'
			<a href="${apptarget}/file/${urlquote(file.file)}">${file.file}</a>
		$if file['Image Set']:
			<a href="${apptarget}/study/${urlquote(file.file)}?action=download">all&nbsp;parts</a>
		</td>
		<td class="file-tags">
		$if 'downloader' in roles:
			<!-- Tags -->
		$else:
			<a href="${apptarget}/tags/${urlquote(file.file)}">Tags</a>
		</td>
		<td class="file-update">
		$if file.writeok:
			<a href="${apptarget}/file/${urlquote(file.file)}?action=define&amp;type=file">Replace&nbsp;with&nbsp;file</a><br />
			<a href="${apptarget}/file/${urlquote(file.file)}?action=define&amp;type=url">Replace&nbsp;with&nbsp;url</a>
		</td>
		$for tag in filelisttags:
			$if tag in skiptags:
				
			$elif tagdefs.has_key(tag):
				$if tagdefs[tag].typestr == '':
					$if file[tag]:
						<td class="file-tag ${idquote(tag)}">${tag}</td>
					$else:
						<td class="file-tag ${idquote(tag)}"></td>
				$else:
					$if tagdefs[tag].multivalue and file[tag]:
						<td class="file-tag ${idquote(tag)}"><table class="file-tag-list">
						$for val in file[tag]:
							<tr><td class="file-tag ${idquote(tag)} multivalue">${val}</td></tr>
						</table></td>
					$else:
						<td class="file-tag ${idquote(tag)}">${file[tag]}</td>
			$else:
				<td class="file-tag"></td>
		$if file.writeok:
			<td class="file-delete">
			<form enctype="application/x-www-form-urlencoded" action="${apptarget}/file/${urlquote(file.file)}" method="post">
			    <div>
			    <input type="hidden" name="action" value="delete" />
			    <input type="hidden" name="referer" value="${referer}" />
			    <input type="submit" value="Delete" />
			    </div>
			</form>
			</td>
		</tr>
	</table>
$elif 'uploader' in roles:
	<p></p>
$else:
	<p>There are no items to list with your current privileges.</p>
