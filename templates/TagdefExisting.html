$def with (title, test_tagdef_authz)
$ target = home + '/tagdef'
$ typenames = [ (type['_type_name'], type['_type_description']) for type in typeinfo ]
$ typenames.sort(key=lambda x: x[1])
$ typedict = dict(typenames)
$ odd = True
<h2>${title}</h2>
<p>
<table class="file-list">
<tr class="file-heading">
<th class="tag-name">Tag name</th>
<th class="tag-type">Type</th>
<th class="tag-multivalue">Cardinality</th>
<th class="tag-owner">Owner</th>
<th class="tag-readpolicy">Read restrictions</th>
<th class="tag-writepolicy">Write restrictions</th>
<th class="tag-delete">Apply</th>
</tr>
$if title == 'User':
    <tr>
    <form enctype="application/x-www-form-urlencoded" action="${target}" method="post">
    <td><input name="tag-1" type="text" /></td>
    <td><select name="type-1">
    $ deftypestr = ''
    <option value="${deftypestr}">${typedict[deftypestr]}</option>
    $for type in [ type for type in typenames[1:] if type[0] != deftypestr ]:
    	$ typestr = type[0]
	<option value="${typestr}">${typedict[typestr]}</option>
    </select></td>
    <td><select name="multivalue-1">
    <option value="false">0 or 1</option>
    <option value="true">0 or more</option>
    </select></td>
    <td>N/A</td>
    $ policies = dict(anonymous='anyone', users='only authenticated users', file='only clients who can access file', fowner='only owner of file', tag='only clients in tagdef ACL')
    <td><select name="readpolicy-1">
    $for pol in ['anonymous', 'users', 'file', 'fowner', 'tag']:
	    <option value="${pol}">${policies[pol]}</option>
    </select></td>
    <td><select name="writepolicy-1">
    $for pol in ['users', 'anonymous', 'file', 'fowner', 'tag']:
	    <option value="${pol}">${policies[pol]}</option>
    </select></td>
    <td>
    <input type="hidden" name="action" value="add" />
    <input type="submit" value="Define tag" />
    </td>
    </form>
    </tr>
    $ odd = not odd
$for tagdef in tagdefsdict.itervalues():
	$if odd:
		<tr class="file odd">
	$else:
		<tr class="file even">
	$ odd = not odd
	<td class="tag name">${tagdef.tagname}</td>
	<td class="tag type">${typedict[tagdef.typestr]}</td>
	<td class="tag cardinality>">
	$if tagdef.multivalue:
		0 or more
	$else:
		0 or 1
	</td>
	<td class="tag owner">${tagdef.owner}</td>
	<td class="tag read acl">
	$:{render.TagdefPolicy(tagdef, 'read')}
	</td>
	<td class="tag write acl">
	$:{render.TagdefPolicy(tagdef, 'write')}
	</td>
	<td class="tag delete">
	<form enctype="application/x-www-form-urlencoded" action="${target}" method="post">
	<input type="hidden" name="tag" value="${tagdef.tagname}" />
	<input type="hidden" name="action" value="delete" />
	$if test_tagdef_authz('write', tagdef.tagname):
		<input type="submit" value="Delete" />
	</form>
	</td>
	</tr>
</table>
