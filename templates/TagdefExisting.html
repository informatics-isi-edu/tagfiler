$def with (title, tagdefs)
$if None:
	$# 
	$# Copyright 2010 University of Southern California
	$# 
	$# Licensed under the Apache License, Version 2.0 (the "License");
	$# you may not use this file except in compliance with the License.
	$# You may obtain a copy of the License at
	$# 
	$#    http://www.apache.org/licenses/LICENSE-2.0
	$# 
	$# Unless required by applicable law or agreed to in writing, software
	$# distributed under the License is distributed on an "AS IS" BASIS,
	$# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	$# See the License for the specific language governing permissions and
	$# limitations under the License.
	$#
$ target = home + '/tagdef'
$ typenames = [ (type['typedef'], type['typedef description']) for type in typeinfo ]
$ typenames.sort(key=lambda x: x[1])
$ typedict = dict(typenames)
<h2>${title}</h2>
<p>
<table class="tagdefs" id="${idquote(title) + '_tagdefs'}">
<tr class="heading">
<th name="tagname">Tag name</th>
<th name="typestr">${jsonWriter(typedict)}</th>
<th name="multivalue">multivalue</th>
<th name="owner">Owner</th>
<th name="readpolicy">readpolicy</th>
<th name="writepolicy">writepolicy</th>
</tr>
$if title == 'User' and len(authn.roles.union(set('*')).intersection(set(config['tagdef write users']))) > 0:
	<tr class="tagdefcreate">
	<form enctype="application/x-www-form-urlencoded" action="${target}" method="post">
	<td><input name="tag-1" type="text" /></td>
	<td><select name="type-1">
	$ deftypestr = 'empty'
	<option value="${deftypestr}">${typedict[deftypestr]}</option>
	$for type in [ type for type in typenames if type[0] != deftypestr ]:
	    $ typestr = type[0]
	    <option value="${typestr}">${typedict[typestr]}</option>
	</select></td>
	<td><select name="multivalue-1">
	<option value="false">0 or 1</option>
	<option value="true">0 or more</option>
	</select></td>
	<td>N/A</td>
	$ policies = dict(anonymous='anyone', users='only authenticated users', subject='only clients who can access subject', subjectowner='only owner of subject', tag='only clients in tagdef ACL')
	<td><select name="readpolicy-1">
	$for pol in ['anonymous', 'users', 'subject', 'subjectowner', 'tag']:
		<option value="${pol}">${policies[pol]}</option>
	</select></td>
	<td><select name="writepolicy-1">
	$for pol in ['users', 'anonymous', 'subject', 'subjectowner', 'tag']:
		<option value="${pol}">${policies[pol]}</option>
	</select>
	<input type="hidden" name="action" value="add" />
	</td>
	</tr>
	<tr class="tagdefcreate"><td><input type="submit" value="Define tag" /></td><td /><td /><td /><td /><td /></form></tr>
$ tagdefs.sort(key=lambda tagdef: tagdef.tagname)
$for tagdef in tagdefs:
	$if tagdef.owner in authn.roles:
		$ writeclass = 'writeok'
	$else:
		$ writeclass = 'readonly'
	<tr class="tagdef ${writeclass}"><td>${tagdef.tagname}</td><td>${tagdef.typestr}</td><td>${jsonWriter(tagdef.multivalue)}</td><td>${tagdef.owner}</td><td>${tagdef.readpolicy}</td><td>${tagdef.writepolicy}</td></tr>
</table>
<script type="text/javascript">
renderTagdefs("${home}", document.getElementById("${idquote(title) + '_tagdefs'}"));
</script>
