$def with ()
$for type in types:
	$ values = type['_type_values']
	$if values:
		$ values = dict(values)
	$else:
		$ values = None
	$ type['_type_values'] = values
$ typesdict = dict ( [ (type['_type_name'], type) for type in types ] )
<div>
	<h3>Status</h3>
	<table>
		<tr>
			<td class="applet">
				<APPLET NAME="TagFileUploader" CODE="edu.isi.misd.tagfiler.TagFilerUploadApplet" CODEBASE="/tagfiler/static"
				 ARCHIVE="isi-misd-tagfiler-upload.jar,apache-mime4j-0.6.jar,commons-codec-1.4.jar,commons-logging-1.1.1.jar,httpclient-4.0.3.jar,httpcore-4.0.1.jar,httpmime-4.0.3.jar,jakarta-commons-httpclient-3.1.jar,jsse.jar,plugin.jar,json-org.jar"
				  width=25 height=25 MAYSCRIPT >
				<PARAM name="tagfiler.server.url" value="${home}"/>
				<PARAM name="classloader_cache" value="false" />
				<PARAM name="separate_jvm" value="true" />
				$if appletTestProperties:
					<PARAM name="tagfiler.applet.test" value="${appletTestProperties}"/>
				$if appletLogfile:
					<PARAM name="tagfiler.applet.log" value="${appletLogfile}"/>
				$if appletCustomProperties:
					<PARAM name="custom.properties" value="${appletCustomProperties}"/>
				$if clientConnections:
					<PARAM name="tagfiler.connections" value="${clientConnections}"/>
				$if clientUploadChunks:
					<PARAM name="tagfiler.allow.chunks" value="${clientUploadChunks}"/>
				$if clientSocketBufferSize:
					<PARAM name="tagfiler.socket.buffer.size" value="${clientSocketBufferSize}"/>
				$if clientChunkbytes:
					<PARAM name="tagfiler.chunkbytes" value="${clientChunkbytes}"/>
				<hr><b>You must have Java-enabled browser (JRE 1.5+) to run the TagFiler Applet.
				  Download JRE 1.5 for your system from the following link:</b><br/>
				<a href="http://www.java.com/en/download/manual.jsp">http://www.java.com/en/download/manual.jsp</a><br/><hr>
				</APPLET>
			</td>
			<td>
				<table>
					<tr>
						<td class="status-wrapper" id="Status" ><b>Select a directory to upload</b></td>
					</tr>
					<tr>
						<td>
							<table class="table-border">
								<tr>
									<td id="ProgressBar">
									$for i in 'Click "Upload All" to begin file upload':
										&nbsp;
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
</div>
<div>
	<h3>Dataset Name</h3>
	<table>
		<tr>
			<td>
				<input id="TransmissionNumber" name="TransmissionNumber" type="text" value="" disabled="disabled" />
			</td>
			<td>
				<input name="DatasetName" id="DatasetName Automatically" type="radio" value="automatically" checked="checked"  onclick="resetDatasetName()" />Generate Automatically
				<br/>
				<input name="DatasetName" id="DatasetName Set" type="radio" value="set" onclick="setDatasetName()" />Set
			</td>
		</tr>
	</table>
</div>
<div>
	<h3>Source Directory for Upload</h3>
	<table>
		<tr>
			<td class="directory" id="DestinationDirectory">
				$for i in range(20):
					&nbsp;
			</td>
			<td>
				<button type="button" name="Browse" id="Browse" disabled="disabled" onclick="uploadBrowse()" >Browse</button>
			</td>
		</tr>
	</table>
</div>
<div>
	<h3>Checksum</h3>
	<input type="checkbox" id="cksum" name="cksum" value="on" checked="checked" />Set
</div>
<div>
	<h3>Submit</h3>
	<button type="button" name="Upload All" id="Upload All" disabled="disabled" onclick="uploadAll()" >Upload All</button>
</div>
<div>
	<h3>Study Tags</h3>
	<table>
	<tr>
	<td>
	<div id="custom-tags">
	<table class="table-wrapper" id="Required Tags">
	$ tagdefs = tagdefsdict.values()
	$ tagdefs.sort(key=lambda tagdef: tagdef.tagname)
	$for tagdef in tagdefs:
		$ type = typesdict[tagdef.typestr]
		$ typedesc = type['_type_description']
		$ typevals = type['_type_values']		
		<tr>
		<td class="tag-name">${tagdef.tagname} (${typedesc})</td>
		<td>
		$ options = tagOptions(tagdef.tagname)
		$if options:
			<select name="${tagdef.tagname}" id="${tagdef.tagname}_id" typestr="${tagdef.typestr}"
		$else:
			<input type="text" name="${tagdef.tagname}" id="${tagdef.tagname}_id" typestr="${tagdef.typestr}" 
		$if tagdef.tagname in appletTagnamesRequire:
			required="required"
		$if options:
			>
		$else:
			/>
			$if tagdef.typestr == "date":
				<a href="javascript:generateCalendar('${tagdef.tagname}_id')"><img src="${home}/static/calendar.gif" width="16" height="16" border="0" alt="Pick a date"></a>
		$if options:
			$ options.sort(key=lambda x: x[0])
			$if typedesc.lower()[0] in [ 'a', 'e', 'i', 'o', 'u' ]:
				$ article = 'an'
			$else:
				$ article = 'a'
			<option value="" selected="selected">Choose ${article} ${typedesc}</option>
			$for option in options:
				<option value="${option[0]}">${option[1]}</option>
			</select>
		</td>
		</tr>
	</table>
	</div>
	</td>
	</tr>
	</table>
</div>
<div>
	<h3>File(s) that will be uploaded</h3>
	<table class="file-list">
		<tr>
			<td class="text-tree" id="Files">
			$for i in 'File(s) that will be uploaded':
				&nbsp;
			</td>
		</tr>
	</table>
</div>
