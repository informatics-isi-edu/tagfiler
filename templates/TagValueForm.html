$def with (args)
$# 
$# Copyright 2010 University of Southern California
$# 
$# Licensed under the Apache License, Version 2.0 (the "License");
$# you may not use this file except in compliance with the License.
$# You may obtain a copy of the License at
$# 
$#    http://www.apache.org/licenses/LICENSE-2.0
$# 
$# Unless required by applicable law or agreed to in writing, software
$# distributed under the License is distributed on an "AS IS" BASIS,
$# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
$# See the License for the specific language governing permissions and
$# limitations under the License.
$#
$ filerecord = args.get('filerecord')
$ tagname = args.get('tagname')
$ typestr = args.get('typestr')
$ typevals = args.get('typevals')
$ val = args.get('val')
$ type = args.get('type')
$ id = args.get('id')
$ name = args.get('name')
$ disabled = args.get('disabled')
$ readonly = args.get('readonly', '')
$ showversions = args.get('showversions', False)
$if type:
	<td>
	<input id="${id}" type="${type}" value="${val}" ${readonly} 
	$if name:
		name="${name}"
	$if disabled:
		disabled="disabled"
	/>
$else:
	<td class="file-tag ${idquote(tagname)} multivalue">
	$if tagname == 'id':
		$ datapred, dataid, dataname = subject2identifiers(filerecord, showversions)
		<table><tr><td><a href="${home}/file/${datapred}">${dataname}</a> <a href="${home}/tags/${datapred}">(tags)</a>
		$if filerecord.get('Image Set', False):
			<a href="${home}/study/${dataid}?action=download">(all&nbsp;parts)</a>
		</td>
		$if filerecord.writeok:
			<td>
			<form enctype="application/x-www-form-urlencoded" action="${home}/file/${datapred}" method="post">
			    <div>
			    <input type="hidden" name="action" value="delete" />
			    <input type="hidden" name="referer" value="${referer}" />
			    <input type="submit" value="Delete" />
			    </div>
			</form>
			</td>
			</tr>
			<tr>
			<td colspan="2">
			Replace with: <a href="${home}/file/${datapred}?action=define&amp;type=file">file</a>, <a href="${home}/file/${datapred}?action=define&amp;type=url">url</a>, <a href="${home}/file/${datapred}?action=define&amp;type=dataset">dataset</a>
			</td>
		</tr>
		</table>
	$elif tagname == 'tagdef' or typestr in ['tagname', 'tagdef']:
		<a href="${home}/tags/tagdef=${urlquote(val)}?view=tagdef%20tags">${val}</a>
	$elif typevals:
		$# this lambda is to simulate ternary operator in Python 2.4
		${val} ${(lambda s: ("", "(%s)" % s)[len(s) > 0])(typevals.get(val, ''))}
	$elif typestr == 'url':
		<a href="${val}">${val}</a>
	$elif typestr == 'file':
		<a href="${home}/file/${urlquote(val)}">${val}</a>
	$elif typestr == 'vfile':
		$ parts = val.split('@')
		$ version = parts[-1]
		$ base = '@'.join(parts[0:-1])
		<a href="${home}/file/${urlquote(base)+'@'+version}">${base+'@'+version}</a>
	$else:
		${val}
</td>
