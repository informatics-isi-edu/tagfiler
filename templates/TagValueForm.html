$def with (args)
$if None:
	$# 
	$# Copyright 2010 University of Southern California
	$# 
	$# Licensed under the Apache License, Version 2.0 (the "License");
	$# you may not use this file except in compliance with the License.
	$# You may obtain a copy of the License at
	$# 
	$#    http://www.apache.org/licenses/LICENSE-2.0
	$# 
	$# Unless required by applicable law or agreed to in writing, software
	$# distributed under the License is distributed on an "AS IS" BASIS,
	$# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	$# See the License for the specific language governing permissions and
	$# limitations under the License.
	$#
$ filerecord = args.get('filerecord')
$ tagname = args.get('tagname')
$ typestr = args.get('typestr')
$ typevals = args.get('typevals')
$ val = args.get('val')
$ type = args.get('type')
$ id = args.get('id')
$ name = args.get('name')
$ disabled = args.get('disabled')
$ readonly = args.get('readonly', '')
$ showversions = args.get('showversions', False)
$if type:
	<td>
	<input id="${id}" type="${type}" value="${val}" ${readonly} 
	$if name:
		name="${name}"
	$if disabled:
		disabled="disabled"
	/>
$else:
	<td class="file-tag ${idquote(tagname)} multivalue">
	$ typedef = typesdict.get(typestr)
	$ tagref = typedef['typedef tagref']
	$if tagname == 'id':
		$ putpred, dataid, dataname, dtype =  subject2identifiers(filerecord, False)
		$ datapred, dataid, dataname, dtype = subject2identifiers(filerecord, showversions)
		$if filerecord.get('Image Set', False):
			$ dtype = 'file'
		<table><tr><td><a href="${home}/file/${datapred}">${dataname}</a> <a href="${home}/tags/${datapred}">(tags)</a>
		$if filerecord.get('Image Set', False):
			$ studyType=filerecord.get('Study Type', None)
			$if studyType == None:
				$ studyType=''
			$else:
				$ studyType='&type='+studyType
			<a href="${home}/study/${dataid}?action=download${studyType}">(all&nbsp;parts)</a>
		</td>
		$if filerecord.writeok and dtype != 'tagdef':
			<td>
					<button type="button" name="Delete" id="Delete" onclick="deleteDataset('${dataname}', '${home}/file/${datapred}')" >Delete</button>
			</td>
			$if filerecord.get('Image Set', False):
				<td>
					<button type="button" name="Delete Contents" id="Delete Contents" onclick="deleteDataset('${dataname}', '${home}/file/${datapred}/')" >Delete Contents</button>
				</td>
				<td>
					<button type="button" name="Delete All" id="Delete All" onclick="deleteAll('${dataname}', '${home}/file/${datapred}')" >Delete All</button>
				</td>
			</tr>
			</table>
			<table>
			<tr>
		$if filerecord.writeok and dtype != 'tagdef':
			<td colspan="2">
				$:{render.DatasetForm(putpred, filerecord)}
			</td>
		</tr>
		</table>
	$elif tagname == 'tagdef':
		<a href="${home}/tags/tagdef=${urlquote(val)}?view=tagdef">${val}</a>
	$elif typevals:
		$# this lambda is to simulate ternary operator in Python 2.4
		${val} ${(lambda s: ("", "(%s)" % s)[len(s) > 0 and s != ("%s" % val)])(typevals.get(val, ''))}
	$elif typestr == 'url':
		<a href="${val}">${val}</a>
	$elif typestr == 'name':
		<a href="${home}/file/name=${urlquote(val)}">${val}</a>
	$elif typestr == 'vname':
		$ parts = val.split('@')
		$ version = parts[-1]
		$ base = '@'.join(parts[0:-1])
		<a href="${home}/file/name=${urlquote(base)};version=${version}">${base+'@'+version}</a>
	$elif typestr == 'id':
		<a href="${home}/file/id=${val}">id=${val}</a> <a href="${home}/tags/id=${val}">(tags)</a>
	$elif tagref:
		<a href="${home}/file/${urlquote(tagref)}=${urlquote(val)}">${tagref}=${val}</a>
	$else:
		${val}
</td>
