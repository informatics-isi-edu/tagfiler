$def with (ops, opsExcludeTypes)
$if None:
	$# 
	$# Copyright 2010 University of Southern California
	$# 
	$# Licensed under the Apache License, Version 2.0 (the "License");
	$# you may not use this file except in compliance with the License.
	$# You may obtain a copy of the License at
	$# 
	$#    http://www.apache.org/licenses/LICENSE-2.0
	$# 
	$# Unless required by applicable law or agreed to in writing, software
	$# distributed under the License is distributed on an "AS IS" BASIS,
	$# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	$# See the License for the specific language governing permissions and
	$# limitations under the License.
	$#
<h3>Add a Query Term</h3>
<p>Select an available tag and click 'Add' to build a query:
</p>
<form enctype="application/x-www-form-urlencoded" action="${queryTarget}" method="get" onsubmit="return checkQueryValues()">
  <table class="query-add"><tr>
  <td><select id="tag" name="tag" onchange='selectTagOperators();'>
  	$ tagnames = tagdefsdict.keys()
	$ tagnames.sort(key=lambda tagname: tagname.lower())
	$ display = None
	$ typestr = None
	$for tagname in tagnames:
		$if tagdefsdict[tagname].readok != False:
			<option typestr="${tagdefsdict[tagname].typestr}" value="${tagname}">${tagname}</option>
			$if not display:
				$ typestr = tagdefsdict[tagname].typestr
				$if tagdefsdict[tagname].typestr == 'empty':
					$ display = 'none'
				$else:
					$ display = 'block'
  </select></td>
  <td><select id="op" name="op" onchange="selectOperatorForm()" >
  	$ firstdisplay = None
  	$for op, desc in ops:
  		$ opdisplay = 'block'
  		$if typestr in opsExcludeTypes[op]:
  			$ opdisplay = 'none'
  		$elif not firstdisplay:
  			$ firstdisplay = op
  			$if display == 'block' and (op == '' or op == ':not:'):
  				$ display = 'none'
		<option value="${op}" id="id_${op}" style="display:${opdisplay};">${desc}</option>
  </select></td>
  <td><table id="tagvalues" style="display:${display};">
	  <tr><td></td><td><input type="text" id="val0" name="val0" /></td></tr>
	  $for i in range(1,10):
	  	<tr><td>OR</td><td><input type="text" id="val${i}" name="val${i}" /></td></tr>
  </table></td>
  <td><input type="submit" value="Add to query" />
  <td><select name="versions">
  	$ optionkeys = { True: 'any', False: 'latest' }
	$ optiondesc = { True: 'Show any version which matches', False: 'Show latest version if matches' }
	<option value="${optionkeys[showVersions]}">${optiondesc[showVersions]}</option>
	<option value="${optionkeys[not showVersions]}">${optiondesc[not showVersions]}</option>
  </select></td>
  </tr></table>
  <input type="hidden" name="action" value="add" />
</form>
<script type="text/javascript">
var opArray = new Array();
$for op in opsExcludeTypes.keys():
	$ vals = ['"'+val+'"' for val in opsExcludeTypes[op]]
	$ vals = ','.join(vals)
	$ key = 'id_' + op
	opArray["$:{key}"] = [$:{vals}];
</script>
