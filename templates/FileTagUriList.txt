$def with (files, tagdefs)
$# 
$# Copyright 2010 University of Southern California
$# 
$# Licensed under the Apache License, Version 2.0 (the "License");
$# you may not use this file except in compliance with the License.
$# You may obtain a copy of the License at
$# 
$#    http://www.apache.org/licenses/LICENSE-2.0
$# 
$# Unless required by applicable law or agreed to in writing, software
$# distributed under the License is distributed on an "AS IS" BASIS,
$# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
$# See the License for the specific language governing permissions and
$# limitations under the License.
$#
$# the following nonsense line is due to a bug in the template engine... don't know why it works but it does!
$for foo in [ 0 ]:
$code
	def rendertagvals(filetagvals):
		s = ""
		for file in files:
			for tagdef in tagdefs:
				if file[tagdef.tagname]:
					if tagdef.typestr == 'empty':
						s += home + "/tags/" + urlquote(file.file) + "/" + urlquote(tagdef.tagname) + "\n"
					elif tagdef.multivalue:
						for val in file[tagdef.tagname]:
							s += home + "/tags/" + urlquote(file.file) + "/" + urlquote(tagdef.tagname) + "=" + urlquote(val) + "\n"
					else:
						s += home + "/tags/" + urlquote(file.file) + "/" + urlquote(tagdef.tagname) + "=" + urlquote(file[tagdef.tagname])
		return s
${rendertagvals(taginfo[4])[:-1]}
