$def with (files, tagdefs)
$# the following nonsense line is due to a bug in the template engine... don't know why it works but it does!
$for foo in [ 0 ]:
$code
	def rendertagvals(filetagvals):
		s = ""
		for file in files:
			for tagdef in tagdefs:
				if file[tagdef.tagname]:
					if tagdef.typestr == '':
						s += home + "/tags/" + urlquote(file.file) + "/" + urlquote(tagdef.tagname) + "\n"
					elif tagdef.multivalue:
						for val in file[tagdef.tagname]:
							s += home + "/tags/" + urlquote(file.file) + "/" + urlquote(tagdef.tagname) + "=" + urlquote(val) + "\n"
					else:
						s += home + "/tags/" + urlquote(file.file) + "/" + urlquote(tagdef.tagname) + "=" + urlquote(file[tagdef.tagname])
		return s
${rendertagvals(taginfo[4])[:-1]}
